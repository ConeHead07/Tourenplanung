<?php

$sql = "SELECT A.Mandant,A.Auftragsnummer,A.Geschaeftsbereich,A.Auftragswert,A.AuftragswertListe,A.Vorgangstitel,A.AnsprechpartnerNachnameLief,A.LieferungStrassePostfach,A.LieferungPostleitzahl,A.LieferungOrt,A.LieferungLand,A.LieferungName,A.Lieferwoche,A.Lieferjahr,A.Liefertermin,A.BestaetigtAm,A.Auftragswert,A.LieferterminFix,A.LieferterminHinweisText, DV.tour_disponiert_am, DA.auftrag_wiedervorlage_am, DA.tour_neulieferungen_count, DA.tour_dispo_count, COUNT(DISTINCT(DV.tour_id)) tour_count, MIN(DV.DatumVon) tour_date_first, MAX(DV.DatumVon) tour_date_last, CASE WHEN DV.DatumVon is null \r\nTHEN 'neu' \r\nWHEN DV.DatumVon is not null AND DA.auftrag_disponiert_am IS NULL AND (DA.tour_dispo_count IS NULL OR DA.tour_dispo_count = 0) \r\nTHEN 'beauftragt' \r\nWHEN DA.auftrag_abgeschlossen_am IS NULL AND DA.tour_neulieferungen_count > 0 \r\nTHEN 'neulieferung' \r\nWHEN DA.auftrag_disponiert_am IS NULL AND DA.tour_dispo_count IS NOT NULL AND DA.tour_dispo_count > 0 \r\nTHEN 'teil' \r\nWHEN DA.auftrag_disponiert_am IS NOT NULL \r\nTHEN 'fertig' \r\nELSE \r\n-- nicht bestimmbar \r\nNULL \r\nEND AS dispoStatus \r\n \nFROM wws_auftragskoepfe A \nLEFT JOIN mr_touren_dispo_auftraege DA\n ON \n A.Mandant = DA.Mandant\n AND A.Auftragsnummer = DA.Auftragsnummer\nLEFT JOIN mr_touren_dispo_vorgaenge DV\n ON \n A.Mandant = DV.Mandant\n AND A.Auftragsnummer = DV.Auftragsnummer \nLEFT JOIN wws_bestellkoepfe B \n ON\n A.Mandant = B.Mandant \n AND A.Auftragsnummer = B.Auftragsnummer \nWHERE 1 AND DA.auftrag_abgeschlossen_am IS NULL \/*dispoStatusWV: disposition *\/ AND DA.auftrag_wiedervorlage_am IS NULL\r\n AND -- filterTime: 1335823200\n -- filterD: 2012-05-01\n -- filterY: 12\n -- filterW: 18\n -- chckMonat: 5\n -- Terminfilter\n -- Zeige Auftr\u00e4ge bzw. die Positionen enthalten die \n -- exakt f\u00fcr diesen Tag vorgesehen\n -- oder vorher und noch nicht 100% gebucht sind\n -- die f\u00fcr keinen Tag exakt vorgesehen, aber f\u00fcr diese Woche\n -- oder vorher und noch nicht 100% gebucht sind\n ( \n (\n (UNIX_TIMESTAMP( A.Liefertermin ) = 0 AND (A.Lieferwoche IS NULL OR A.Lieferwoche = 0) )\n OR (DATE(A.Liefertermin) >= '2012-05-01')\n OR ( (A.Lieferjahr*100+A.Lieferwoche) >= (12 * 100 + 18) )\n )\n )\r\n AND A.Bearbeitungsstatus BETWEEN 2 AND 8 AND A.Auftragsnummer LIKE '186188%'\r\n GROUP BY A.Mandant, A.Auftragsnummer\r\nLIMIT 0, 30";

echo '<pre>' . $sql . '</pre>' . PHP_EOL;


